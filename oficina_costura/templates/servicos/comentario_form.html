{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2>Editar Coment√°rio</h2>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Campo do coment√°rio -->
        <label for="{{ form.comentario.id_for_label }}">Coment√°rio</label>
        {{ form.comentario }}

        <!-- Upload de imagens novas -->
        <label for="imagens">Adicionar Imagens</label>
        <input type="file" name="imagens" multiple accept="image/*">

        <!-- Imagens j√° anexadas -->
        {% if imagens %}
        <div class="comentario-imagens">
            <h4>Imagens anexadas:</h4>
            <div class="imagens-wrapper">
                {% for img in imagens %}
                    <div class="img-card">
                        <img src="{{ img.imagem.url }}" onclick="abrirImagem('{{ img.imagem.url }}')" alt="Imagem do coment√°rio">
                        <a href="{% url 'excluir_imagem' img.id %}" 
                           onclick="return confirm('Excluir imagem?')"
                           class="btn btn-delete">üóë</a>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="form-buttons">
            <button type="submit" class="btn btn-success">üíæ Salvar</button>
            <a href="{% url 'servicos_detalhe' comentario.ordem_servico.id %}" class="btn btn-cancel">‚ùå Cancelar</a>
            <a href="{% url 'excluir_comentario' comentario.id %}" onclick="return confirm('Excluir coment√°rio?')" class="btn-remove">üóë Excluir Coment√°rio</a>
        </div>
    </form>
</div>
<div id="modal-imagem" class="modal" onclick="fecharImagem()">
    <img id="modal-img">
</div>
<script>
    function abrirImagem(src) {
        document.getElementById("modal-img").src = src;
        document.getElementById("modal-imagem").style.display = "flex";
    }

    function fecharImagem() {
        document.getElementById("modal-imagem").style.display = "none";
    }
</script>
<style>
.comentario-imagens {
    margin-top: 20px;
}

.imagens-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.img-card {
    position: relative;
    width: 100px;
    height: 100px;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #ccc;
}

.img-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.btn-delete {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: rgba(255, 0, 0, 0.7);
    color: white;
    padding: 2px 6px;
    border-radius: 50%;
    text-decoration: none;
    font-weight: bold;
}

.btn-delete:hover {
    background-color: rgba(200,0,0,0.9);
}
</style>

{% endblock %}